# Detecting and Analyzing Network Traffic with Suricata

## Project Overview
This project involves using Suricata, an open-source network threat detection engine, to monitor, detect, and analyze network traffic using Kali Linux. The goal is to identify suspicious activities, understand the nature of network traffic, and enhance skills in intrusion detection and prevention. This project is crucial for understanding how network-based threats are detected and how actionable insights can be derived from traffic analysis.

## Approach & Tools

### Environment Setup:
- Deployed a controlled network environment using VirtualBox.
- Installed Suricata on a dedicated monitoring virtual machine.

### Tools Used:
- **Suricata**: An advanced intrusion detection and prevention system (IDS/IPS) and network security monitoring tool.
- **Virtual Machine**: Kali Linux

### Procedure:
1. Configured Suricata to monitor specific network interfaces.
   ```bash
   sudo apt update
   sudo apt install suricata
   sudo suricata-update
   ```
2. Tuned Suricata rules to identify specific types of threats. To access the rules:
   ```bash
   nano /var/lib/suricata/rules/local.rules
   ```
3. Created an alert rule:
   ```bash
   alert icmp any any -> any any (msg:"ICMP Ping Detected"; itype:8; sid:1000001; rev:1;)
   ```

#### Rule Properties:
- ICMP network traffic from any source IP and port to any destination IP and port.
- A message will be logged by Suricata when the alert is generated.
- **ICMP type 8** - responds to echo requests from ping operations.
- **SID** is the unique identifier.

**Summary**: The alert will detect any ICMP request to any source and destination.

## Implementation & Findings

### Steps Taken:
1. Configured a test network with a mixture of benign and malicious traffic sources.
2. Installed and set up Suricata to operate in IDS mode.
3. Loaded community rules to detect common threats such as port scans, brute force attempts, and malware traffic.
4. Captured and analyzed traffic logs generated by Suricata.

### Triggering the Alert Rule in Suricata:
1. Open the Suricata configuration file:
   ```bash
   sudo nano /etc/suricata/suricata.yaml
   ```
2. Locate the `rules-files` line and add the `local.rules` file where the alert was created.
3. Verify the rule loading:
   ```bash
   sudo suricata -c /etc/suricata/suricata.yaml -i eth0 -v
   ```
4. Generate and analyze alerts:
   ```bash
   ping -c 4 8.8.8.8  # Google server
   ```
5. Check logs for analysis:
   ```bash
   sudo cat /var/log/suricata/eve.json | grep "ICMP Ping Detected"
   ```
6. To check normal rules for Suricata:
   ```bash
   cd /var/lib/suricata/rules
   ```
7. Used Wireshark to verify and cross-reference suspicious traffic detected by Suricata.

### Key Observations:
- Suricata successfully detected simulated port scans and brute force attempts.
- Detailed logs provided insight into source IP addresses, destination ports, and payloads.
- False positives were identified, requiring fine-tuning of detection rules.

## Solutions & Recommendations

### Addressing the Issues:
#### Rule Tuning:
- Customize rules to reduce false positives while maintaining detection accuracy.
- Add rules specific to the test networkâ€™s configuration and expected traffic.

#### Log Management:
- Use tools like Elasticsearch and Kibana to visualize and manage Suricata logs.
- Implement automated alerts for critical detections.

### Proposed Improvements:
- Incorporate encrypted traffic analysis to detect threats hidden within SSL/TLS sessions.
- Test additional Suricata modes, such as inline IPS, for proactive threat prevention.

### Next Steps:
- Expand the test network to include diverse traffic patterns.
- Integrate Suricata with a Security Information and Event Management (SIEM) system for advanced analysis.
- Explore the use of machine learning models to enhance detection capabilities.

## Conclusion & References
This project demonstrated the effectiveness of Suricata in detecting and analyzing network traffic in a controlled environment. By fine-tuning rules and leveraging complementary tools, Suricata can provide significant insights into network threats and improve overall security posture.

**Learned:**
- What a network IDS is.
- How to set one up.
- How to create rules to detect malicious activity.
- How to respond to those rules to protect networks and customers.

### References:
- [Suricata Documentation](https://suricata.io/documentation/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
